<!doctype lake><title>3.3 JSON数据返回类，自定义JSON转换器</title><meta name="doc-version" content="1" /><meta name="viewport" content="adapt" /><meta name="typography" content="classic" /><meta name="paragraphSpacing" content="relax" /><meta name="defaultFontsize" content="16" /><h1 data-lake-id="jkbup" id="jkbup"><span data-lake-id="ua1188480" id="ua1188480" style="color: #080808; background-color: #ffffff">一、JSON 介绍</span></h1><p data-lake-id="ubf54bc14" id="ubf54bc14"><strong><span data-lake-id="ubae8969a" id="ubae8969a">JSON（JavaScript Object Notation）</span></strong><span data-lake-id="u41c645c5" id="u41c645c5"> 是一种非常常用的数据交换格式，用于在客户端和服务器之间传递数据。它具有轻量级、易于阅读和解析的特点，非常适合在 Web 应用和 RESTful API 中使用。</span></p><h3 data-lake-id="Ji1Gp" id="Ji1Gp"><strong><span data-lake-id="u075541e9" id="u075541e9">1. JSON 的基本结构</span></strong></h3><p data-lake-id="ufa57dbde" id="ufa57dbde"><span data-lake-id="u07a0199e" id="u07a0199e" style="color: #080808; background-color: #ffffff">JSON 是一种键值对格式的数据表示方法，支持以下几种数据类型：</span></p><ul list="u767f292d"><li fid="u2fa160d6" data-lake-id="ua20f6d7f" id="ua20f6d7f"><strong><span data-lake-id="u07d3ff21" id="u07d3ff21">对象</span></strong><span data-lake-id="ue770d9bd" id="ue770d9bd" style="color: #080808; background-color: #ffffff">：用 </span><code data-lake-id="ueee1dcd0" id="ueee1dcd0"><span data-lake-id="ud133e359" id="ud133e359" style="color: #080808; background-color: #ffffff">{}</span></code><span data-lake-id="u8afc62b7" id="u8afc62b7" style="color: #080808; background-color: #ffffff"> 包裹，表示一组键值对。</span></li></ul><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22json%22%2C%22code%22%3A%22%7B%5Cn%20%20%5C%22name%5C%22%3A%20%5C%22Alice%5C%22%2C%5Cn%20%20%5C%22age%5C%22%3A%2025%2C%5Cn%20%20%5C%22isStudent%5C%22%3A%20false%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22bmNGZ%22%7D"></card><ul list="u767f292d" start="2"><li fid="u2fa160d6" data-lake-id="udb84af7b" id="udb84af7b"><strong><span data-lake-id="u0be586bb" id="u0be586bb">数组</span></strong><span data-lake-id="ue218d92a" id="ue218d92a" style="color: #080808; background-color: #ffffff">：用 </span><code data-lake-id="u56d005f3" id="u56d005f3"><span data-lake-id="u0346125d" id="u0346125d" style="color: #080808; background-color: #ffffff">[]</span></code><span data-lake-id="u9c022b85" id="u9c022b85" style="color: #080808; background-color: #ffffff"> 包裹，表示一组有序的值。</span></li></ul><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22json%22%2C%22code%22%3A%22%5B%5Cn%20%20%5C%22apple%5C%22%2C%5Cn%20%20%5C%22banana%5C%22%2C%5Cn%20%20%5C%22cherry%5C%22%5Cn%5D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22GIkan%22%7D"></card><ul list="u767f292d" start="3"><li fid="u2fa160d6" data-lake-id="ua7d6ec34" id="ua7d6ec34"><strong><span data-lake-id="uc4331bed" id="uc4331bed">基本数据类型</span></strong><span data-lake-id="u46de2a03" id="u46de2a03" style="color: #080808; background-color: #ffffff">：字符串、数字、布尔值、</span><code data-lake-id="u73f2e235" id="u73f2e235"><span data-lake-id="u24cf841a" id="u24cf841a" style="color: #080808; background-color: #ffffff">null</span></code><span data-lake-id="u836bd04b" id="u836bd04b" style="color: #080808; background-color: #ffffff">。</span></li></ul><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22json%22%2C%22code%22%3A%22%5C%22string%5C%22%5Cn123%5Cntrue%5Cnnull%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22Mkjut%22%7D"></card><h4 data-lake-id="uxxbl" id="uxxbl"><span data-lake-id="uf6523979" id="uf6523979">实例：</span></h4><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22json%22%2C%22code%22%3A%22%7B%5Cn%20%20%5C%22name%5C%22%3A%20%5C%22%E5%B0%8F%E6%98%8E%5C%22%2C%5Cn%20%20%5C%22age%5C%22%3A%2020%2C%5Cn%20%20%5C%22hobbies%5C%22%3A%20%5B%5C%22%E8%AF%BB%E4%B9%A6%5C%22%2C%20%5C%22%E8%B7%91%E6%AD%A5%5C%22%2C%20%5C%22%E7%BC%96%E7%A8%8B%5C%22%5D%2C%5Cn%20%20%5C%22address%5C%22%3A%20%7B%5Cn%20%20%20%20%5C%22city%5C%22%3A%20%5C%22%E5%8C%97%E4%BA%AC%5C%22%2C%5Cn%20%20%20%20%5C%22street%5C%22%3A%20%5C%22%E6%9C%9D%E9%98%B3%E5%8C%BA%5C%22%5Cn%20%20%7D%2C%5Cn%20%20%5C%22friends%5C%22%3A%20%5B%5Cn%20%20%20%20%7B%5Cn%20%20%20%20%20%20%5C%22name%5C%22%3A%20%5C%22%E5%B0%8F%E7%BA%A2%5C%22%2C%5Cn%20%20%20%20%20%20%5C%22age%5C%22%3A%2022%5Cn%20%20%20%20%7D%2C%5Cn%20%20%20%20%7B%5Cn%20%20%20%20%20%20%5C%22name%5C%22%3A%20%5C%22%E5%B0%8F%E6%9D%8E%5C%22%2C%5Cn%20%20%20%20%20%20%5C%22age%5C%22%3A%2023%5Cn%20%20%20%20%7D%5Cn%20%20%5D%2C%5Cn%20%20%5C%22school%5C%22%3A%20%7B%5Cn%20%20%20%20%5C%22name%5C%22%3A%20%5C%22%E5%85%89%E6%98%8E%E4%B8%AD%E5%AD%A6%5C%22%2C%5Cn%20%20%20%20%5C%22location%5C%22%3A%20%7B%5Cn%20%20%20%20%20%20%5C%22city%5C%22%3A%20%5C%22%E5%8C%97%E4%BA%AC%5C%22%2C%5Cn%20%20%20%20%20%20%5C%22district%5C%22%3A%20%5C%22%E6%B5%B7%E6%B7%80%E5%8C%BA%5C%22%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Atrue%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22fontSize%22%3A14%2C%22customStyle%22%3A%5B%5D%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22Jr0C1%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D"></card><p data-lake-id="ucc93f2d2" id="ucc93f2d2"><strong><span data-lake-id="u4c539aab" id="u4c539aab" style="color: rgb(6, 6, 7)">总结：</span></strong></p><ul list="uf9e8dbbb"><li fid="u2e735c23" data-lake-id="u0f95d861" id="u0f95d861"><strong><span data-lake-id="ub2b78391" id="ub2b78391" class="lake-fontsize-11" style="color: rgb(6, 6, 7)">对象</span></strong><span data-lake-id="u30662b33" id="u30662b33" class="lake-fontsize-11" style="color: rgb(6, 6, 7)">（</span><code data-lake-id="ub62111f1" id="ub62111f1"><span data-lake-id="u4b226240" id="u4b226240" class="lake-fontsize-11" style="color: var(--text-primary)">{}</span></code><span data-lake-id="u47d510a2" id="u47d510a2" class="lake-fontsize-11" style="color: rgb(6, 6, 7)">）：表示一个集合，包含多个键值对。</span></li><li fid="u2e735c23" data-lake-id="ua477769c" id="ua477769c"><strong><span data-lake-id="u31a82627" id="u31a82627" class="lake-fontsize-11" style="color: rgb(6, 6, 7)">数组</span></strong><span data-lake-id="u56bc7882" id="u56bc7882" class="lake-fontsize-11" style="color: rgb(6, 6, 7)">（</span><code data-lake-id="u7d5c9b36" id="u7d5c9b36"><span data-lake-id="ufdb42314" id="ufdb42314" class="lake-fontsize-11" style="color: var(--text-primary)">[]</span></code><span data-lake-id="u154c0b5f" id="u154c0b5f" class="lake-fontsize-11" style="color: rgb(6, 6, 7)">）：表示一个列表，包含多个元素（可以是字符串、数字、对象等）。</span></li><li fid="u2e735c23" data-lake-id="u42a55efa" id="u42a55efa"><strong><span data-lake-id="uc3f7a7fd" id="uc3f7a7fd" class="lake-fontsize-11" style="color: rgb(6, 6, 7)">嵌套结构</span></strong><span data-lake-id="u534b55f2" id="u534b55f2" class="lake-fontsize-11" style="color: rgb(6, 6, 7)">：对象中可以包含对象或数组，数组中也可以包含对象，这种结构可以用来表示复杂的数据关系。</span></li></ul><h3 data-lake-id="mcbbD" id="mcbbD"><strong><span data-lake-id="u3063e129" id="u3063e129">2. JSON 在 Web 开发中的应用场景</span></strong></h3><h4 data-lake-id="dcbWq" id="dcbWq"><strong><span data-lake-id="u5586e09f" id="u5586e09f">场景 1：客户端向服务器发送数据</span></strong></h4><p data-lake-id="u357dccac" id="u357dccac"><span data-lake-id="u82f19ba1" id="u82f19ba1" style="color: #080808; background-color: #ffffff">当客户端（如浏览器或移动应用）需要向服务器发送数据时，通常会将数据封装为 JSON 格式，然后通过 HTTP 请求（如 POST 或 PUT）发送给服务器。</span></p><p data-lake-id="u90af5f04" id="u90af5f04"><strong><span data-lake-id="u50779fc9" id="u50779fc9">示例：用户注册</span></strong><span data-lake-id="ud7eb6f94" id="ud7eb6f94" style="color: #080808; background-color: #ffffff"><br /></span><span data-lake-id="u8b32fdd4" id="u8b32fdd4" style="color: #080808; background-color: #ffffff">客户端需要向服务器发送用户信息，包括用户名、密码和邮箱。</span></p><p data-lake-id="uafc8ee19" id="uafc8ee19"><strong><span data-lake-id="u8bf534db" id="u8bf534db">JSON 数据示例</span></strong><span data-lake-id="u71417796" id="u71417796" style="color: #080808; background-color: #ffffff">：</span></p><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22json%22%2C%22code%22%3A%22%7B%5Cn%20%20%5C%22username%5C%22%3A%20%5C%22Alice%5C%22%2C%5Cn%20%20%5C%22password%5C%22%3A%20%5C%22password123%5C%22%2C%5Cn%20%20%5C%22email%5C%22%3A%20%5C%22alice%40example.com%5C%22%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22yOhTh%22%7D"></card><p data-lake-id="ue98bb3c7" id="ue98bb3c7"><strong><span data-lake-id="uce09b803" id="uce09b803">HTTP 请求示例</span></strong><span data-lake-id="u53d9a9e8" id="u53d9a9e8" style="color: #080808; background-color: #ffffff">：</span></p><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%22POST%20%2Fapi%2Fusers%20HTTP%2F1.1%5CnHost%3A%20example.com%5CnContent-Type%3A%20application%2Fjson%5Cn%5Cn%7B%5Cn%20%20%5C%22username%5C%22%3A%20%5C%22Alice%5C%22%2C%5Cn%20%20%5C%22password%5C%22%3A%20%5C%22password123%5C%22%2C%5Cn%20%20%5C%22email%5C%22%3A%20%5C%22alice%40example.com%5C%22%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22BbU9b%22%7D"></card><h4 data-lake-id="RnCcy" id="RnCcy"><strong><span data-lake-id="ua7e50113" id="ua7e50113">场景 2：服务器向客户端返回数据</span></strong></h4><p data-lake-id="u939778c4" id="u939778c4"><span data-lake-id="ufae08e53" id="ufae08e53" style="color: #080808; background-color: #ffffff">服务器处理完客户端的请求后，通常会将结果封装为 JSON 格式返回给客户端。</span></p><p data-lake-id="u90f2ab1f" id="u90f2ab1f"><strong><span data-lake-id="ufeb3b84e" id="ufeb3b84e">示例：获取用户信息</span></strong><span data-lake-id="u86cf0956" id="u86cf0956" style="color: #080808; background-color: #ffffff"><br /></span><span data-lake-id="ub5d7675d" id="ub5d7675d" style="color: #080808; background-color: #ffffff">客户端请求获取用户信息，服务器返回用户的基本信息。</span></p><p data-lake-id="u1c9141d8" id="u1c9141d8"><strong><span data-lake-id="ub7b77053" id="ub7b77053">JSON 数据示例</span></strong><span data-lake-id="u0706ecf1" id="u0706ecf1" style="color: #080808; background-color: #ffffff">：</span></p><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22json%22%2C%22code%22%3A%22%7B%5Cn%20%20%5C%22id%5C%22%3A%201%2C%5Cn%20%20%5C%22username%5C%22%3A%20%5C%22Alice%5C%22%2C%5Cn%20%20%5C%22email%5C%22%3A%20%5C%22alice%40example.com%5C%22%2C%5Cn%20%20%5C%22createdAt%5C%22%3A%20%5C%222024-01-01T12%3A00%3A00Z%5C%22%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22enCdO%22%7D"></card><p data-lake-id="u1f6b230f" id="u1f6b230f"><strong><span data-lake-id="ub989e7c7" id="ub989e7c7">HTTP 响应示例</span></strong><span data-lake-id="u6a1ab64d" id="u6a1ab64d" style="color: #080808; background-color: #ffffff">：</span></p><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%22HTTP%2F1.1%20200%20OK%5CnContent-Type%3A%20application%2Fjson%5Cn%5Cn%7B%5Cn%20%20%5C%22id%5C%22%3A%201%2C%5Cn%20%20%5C%22username%5C%22%3A%20%5C%22Alice%5C%22%2C%5Cn%20%20%5C%22email%5C%22%3A%20%5C%22alice%40example.com%5C%22%2C%5Cn%20%20%5C%22createdAt%5C%22%3A%20%5C%222024-01-01T12%3A00%3A00Z%5C%22%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22HdzIo%22%7D"></card><h3 data-lake-id="hmeCn" id="hmeCn"><strong><span data-lake-id="u21463b74" id="u21463b74">3. JSON 的优点</span></strong></h3><ol list="u1383c17c"><li fid="ubcf0c379" data-lake-id="u3b8735b8" id="u3b8735b8"><strong><span data-lake-id="u254bdced" id="u254bdced">轻量级</span></strong><span data-lake-id="uc39e7751" id="uc39e7751" style="color: #080808; background-color: #ffffff">：JSON 数据格式简洁，传输效率高。</span></li><li fid="ubcf0c379" data-lake-id="ue139f18b" id="ue139f18b"><strong><span data-lake-id="u9e6273b2" id="u9e6273b2">易于解析</span></strong><span data-lake-id="u2dfaf058" id="u2dfaf058" style="color: #080808; background-color: #ffffff">：大多数编程语言都支持 JSON 的解析和生成。</span></li><li fid="ubcf0c379" data-lake-id="u83fdab52" id="u83fdab52"><strong><span data-lake-id="ue5f929fc" id="ue5f929fc">跨语言支持</span></strong><span data-lake-id="u17ecd67c" id="u17ecd67c" style="color: #080808; background-color: #ffffff">：JSON 是一种通用的数据格式，可以在 JavaScript、Java、Python、C# 等多种语言之间无缝交换数据。</span></li><li fid="ubcf0c379" data-lake-id="uf6831fa9" id="uf6831fa9"><strong><span data-lake-id="udfaefe86" id="udfaefe86">易于阅读</span></strong><span data-lake-id="u7704f929" id="u7704f929" style="color: #080808; background-color: #ffffff">：JSON 格式接近人类可读的格式，便于调试和开发。</span></li></ol><h3 data-lake-id="HgSYm" id="HgSYm"><strong><span data-lake-id="u60a91abc" id="u60a91abc">4. JSON 的使用注意事项</span></strong></h3><ol list="u3ecad00d"><li fid="u5277aff9" data-lake-id="ua8da4f99" id="ua8da4f99"><strong><span data-lake-id="uffb425f7" id="uffb425f7">编码问题</span></strong><span data-lake-id="u5355784c" id="u5355784c" style="color: #080808; background-color: #ffffff">：确保 JSON 数据的编码格式（如 UTF-8）一致，避免乱码问题。</span></li><li fid="u5277aff9" data-lake-id="ue333b067" id="ue333b067"><strong><span data-lake-id="uddf660ff" id="uddf660ff">数据安全</span></strong><span data-lake-id="ud752a5f3" id="ud752a5f3" style="color: #080808; background-color: #ffffff">：在传输敏感数据时，应使用 HTTPS 加密传输，避免数据被窃取。</span></li><li fid="u5277aff9" data-lake-id="uda21fb30" id="uda21fb30"><strong><span data-lake-id="u1694f199" id="u1694f199">数据校验</span></strong><span data-lake-id="u38b42847" id="u38b42847" style="color: #080808; background-color: #ffffff">：在接收和处理 JSON 数据时，应对数据进行校验，确保数据的完整性和合法性。</span></li><li fid="u5277aff9" data-lake-id="u3a203dbd" id="u3a203dbd"><strong><span data-lake-id="u52bb4673" id="u52bb4673">性能优化</span></strong><span data-lake-id="uc99b2390" id="uc99b2390" style="color: #080808; background-color: #ffffff">：避免传输过大的 JSON 数据，可以对数据进行分页或压缩。</span></li></ol><h1 data-lake-id="zgVAf" id="zgVAf"><span data-lake-id="ufb8fd82c" id="ufb8fd82c" style="color: #080808; background-color: #ffffff">二、</span><span data-lake-id="ueb00903c" id="ueb00903c">什么是 JSON 数据返回类？</span></h1><p data-lake-id="uf444b20a" id="uf444b20a"><span data-lake-id="u4d7e25a5" id="u4d7e25a5" style="color: #080808; background-color: #ffffff">为了方便地生成和管理这些 JSON 数据，项目中我们一般会定义一个 </span><strong><span data-lake-id="u65737b93" id="u65737b93">JSON 数据返回类</span></strong><span data-lake-id="udf718b07" id="udf718b07" style="color: #080808; background-color: #ffffff">。这个类就像是一个“</span><strong><span data-lake-id="ud918dfa6" id="ud918dfa6" style="color: #080808; background-color: #ffffff">数据包装器</span></strong><span data-lake-id="u6f5ff0f1" id="u6f5ff0f1" style="color: #080808; background-color: #ffffff">”，它把需要返回的信息（比如：状态码、提示信息和实际数据）封装在一起，然后发送给客户端。</span></p><ol list="ue31e6ded"><li fid="u26ce4c09" data-lake-id="u8ab65f9b" id="u8ab65f9b"><strong><span data-lake-id="u02862456" id="u02862456">统一格式</span></strong><span data-lake-id="u9582a608" id="u9582a608" style="color: #080808; background-color: #ffffff">：让所有的返回数据都有一个统一的结构，方便客户端解析。</span></li><li fid="u26ce4c09" data-lake-id="ue8c01d31" id="ue8c01d31"><strong><span data-lake-id="u7563e077" id="u7563e077">方便管理</span></strong><span data-lake-id="ucb35de51" id="ucb35de51" style="color: #080808; background-color: #ffffff">：通过一个类来管理返回的数据，代码更清晰，也更容易维护。</span></li><li fid="u26ce4c09" data-lake-id="u5dd47d19" id="u5dd47d19"><strong><span data-lake-id="u645e40c7" id="u645e40c7">提高效率</span></strong><span data-lake-id="u8744a16b" id="u8744a16b" style="color: #080808; background-color: #ffffff">：减少重复代码，开发者只需要调用这个类的方法，就可以快速生成响应。</span></li></ol><h3 data-lake-id="gmUQ7" id="gmUQ7"><strong><span data-lake-id="u36cbc949" id="u36cbc949">一个简单的 JSON 数据返回类</span></strong></h3><p data-lake-id="u295c568b" id="u295c568b"><span data-lake-id="u96ec8b11" id="u96ec8b11" style="color: #080808; background-color: #ffffff">假设我们正在开发一个用户管理系统，客户端请求获取用户信息。服务器需要返回用户的数据，或者在失败时返回错误信息。</span></p><h4 data-lake-id="uHJP2" id="uHJP2"><strong><span data-lake-id="ub215c31a" id="ub215c31a">成功时返回的数据</span></strong></h4><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22json%22%2C%22code%22%3A%22%7B%5Cn%20%20%5C%22code%5C%22%3A%20%5C%220%5C%22%2C%5Cn%20%20%5C%22msg%5C%22%3A%20%5C%22%E6%88%90%E5%8A%9F%5C%22%2C%5Cn%20%20%5C%22data%5C%22%3A%20%7B%5Cn%20%20%20%20%5C%22id%5C%22%3A%201%2C%5Cn%20%20%20%20%5C%22username%5C%22%3A%20%5C%22Alice%5C%22%2C%5Cn%20%20%20%20%5C%22email%5C%22%3A%20%5C%22alice%40example.com%5C%22%5Cn%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22b7Nvz%22%7D"></card><h4 data-lake-id="He7Ln" id="He7Ln"><strong><span data-lake-id="uc6cce64d" id="uc6cce64d">失败时返回的数据</span></strong></h4><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22json%22%2C%22code%22%3A%22%7B%5Cn%20%20%5C%22code%5C%22%3A%20%5C%221%5C%22%2C%5Cn%20%20%5C%22msg%5C%22%3A%20%5C%22%E7%94%A8%E6%88%B7%E4%B8%8D%E5%AD%98%E5%9C%A8%5C%22%2C%5Cn%20%20%5C%22data%5C%22%3A%20null%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22PPStr%22%7D"></card><h4 data-lake-id="iCylR" id="iCylR"><span data-lake-id="u2407d7e6" id="u2407d7e6">定义类来包装 JSON 数据</span></h4><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22java%22%2C%22code%22%3A%22public%20class%20JsonResponse%3CT%3E%20%7B%5Cn%20%20%20%20private%20String%20code%3B%20%20%2F%2F%20%E7%8A%B6%E6%80%81%E7%A0%81%5Cn%20%20%20%20private%20String%20msg%3B%20%20%20%2F%2F%20%E6%8F%90%E7%A4%BA%E4%BF%A1%E6%81%AF%5Cn%20%20%20%20private%20T%20data%3B%20%20%20%20%20%20%20%2F%2F%20%E5%AE%9E%E9%99%85%E6%95%B0%E6%8D%AE%5Cn%5Cn%20%20%20%20%2F%2F%20%E6%88%90%E5%8A%9F%E6%97%B6%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%5Cn%20%20%20%20public%20JsonResponse(T%20data)%20%7B%5Cn%20%20%20%20%20%20%20%20this.code%20%3D%20%5C%220%5C%22%3B%20%20%2F%2F%20%E9%BB%98%E8%AE%A4%E6%88%90%E5%8A%9F%E7%8A%B6%E6%80%81%E7%A0%81%5Cn%20%20%20%20%20%20%20%20this.msg%20%3D%20%5C%22%E6%88%90%E5%8A%9F%5C%22%3B%20%2F%2F%20%E9%BB%98%E8%AE%A4%E6%88%90%E5%8A%9F%E6%8F%90%E7%A4%BA%5Cn%20%20%20%20%20%20%20%20this.data%20%3D%20data%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%20%E5%A4%B1%E8%B4%A5%E6%97%B6%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%5Cn%20%20%20%20public%20JsonResponse(String%20code%2C%20String%20msg)%20%7B%5Cn%20%20%20%20%20%20%20%20this.code%20%3D%20code%3B%5Cn%20%20%20%20%20%20%20%20this.msg%20%3D%20msg%3B%5Cn%20%20%20%20%20%20%20%20this.data%20%3D%20null%3B%20%2F%2F%20%E5%A4%B1%E8%B4%A5%E6%97%B6%E6%B2%A1%E6%9C%89%E6%95%B0%E6%8D%AE%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%20Getter%20%E6%96%B9%E6%B3%95%5Cn%20%20%20%20public%20String%20getCode()%20%7B%20return%20code%3B%20%7D%5Cn%20%20%20%20public%20String%20getMsg()%20%7B%20return%20msg%3B%20%7D%5Cn%20%20%20%20public%20T%20getData()%20%7B%20return%20data%3B%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22AJTaU%22%7D"></card><h4 data-lake-id="AJVP2" id="AJVP2"><strong><span data-lake-id="ucb026016" id="ucb026016">使用这个类</span></strong></h4><p data-lake-id="u49df3c53" id="u49df3c53"><span data-lake-id="ud6069710" id="ud6069710" style="color: #080808; background-color: #ffffff">假设客户端请求获取用户信息，服务器通过这个类返回数据：</span></p><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%20%E6%88%90%E5%8A%9F%E6%97%B6%5CnJsonResponse%3CUser%3E%20successResponse%20%3D%20new%20JsonResponse%3C%3E(new%20User(1%2C%20%5C%22Alice%5C%22%2C%20%5C%22alice%40example.com%5C%22))%3B%5Cn%5Cn%2F%2F%20%E5%A4%B1%E8%B4%A5%E6%97%B6%5CnJsonResponse%3CString%3E%20failResponse%20%3D%20new%20JsonResponse%3C%3E(%5C%221%5C%22%2C%20%5C%22%E7%94%A8%E6%88%B7%E4%B8%8D%E5%AD%98%E5%9C%A8%5C%22)%3B%22%2C%22autoWrap%22%3Atrue%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22MmJ45%22%7D"></card><h3 data-lake-id="j2lkR" id="j2lkR"><strong><span data-lake-id="ufe12ff01" id="ufe12ff01">总结</span></strong></h3><ul list="u5303e744"><li fid="u3e87e5d7" data-lake-id="u80e7eb3c" id="u80e7eb3c"><strong><span data-lake-id="u19ad2383" id="u19ad2383">JSON 数据返回类</span></strong><span data-lake-id="u636684ac" id="u636684ac" style="color: #080808; background-color: #ffffff"> 是一个工具，用来封装返回给客户端的数据。</span></li><li fid="u3e87e5d7" data-lake-id="u1d54d7c4" id="u1d54d7c4"><span data-lake-id="uf608a18e" id="uf608a18e" style="color: #080808; background-color: #ffffff">它包含 </span><strong><span data-lake-id="u7f397620" id="u7f397620">状态码（code）</span></strong><span data-lake-id="ua94e5aaa" id="ua94e5aaa" style="color: #080808; background-color: #ffffff">、</span><strong><span data-lake-id="u8d4d2804" id="u8d4d2804">提示信息（msg）</span></strong><span data-lake-id="ue6b4a04c" id="ue6b4a04c" style="color: #080808; background-color: #ffffff"> 和 </span><strong><span data-lake-id="uc8ddb204" id="uc8ddb204">实际数据（data）</span></strong><span data-lake-id="u649659f4" id="u649659f4" style="color: #080808; background-color: #ffffff">。</span></li><li fid="u3e87e5d7" data-lake-id="uf98eb36c" id="uf98eb36c"><span data-lake-id="ueebe5719" id="ueebe5719" style="color: #080808; background-color: #ffffff">使用这个类可以让返回的数据格式统一，方便客户端解析和处理。</span></li></ul><p data-lake-id="ue0c9ee7b" id="ue0c9ee7b"><span data-lake-id="u67228303" id="u67228303" style="color: #080808; background-color: #ffffff">就像你打包礼物一样，</span><code data-lake-id="u5c1a035a" id="u5c1a035a"><span data-lake-id="u3048833a" id="u3048833a" style="color: #080808; background-color: #ffffff">JsonResponse</span></code><span data-lake-id="ucc036f7f" id="ucc036f7f" style="color: #080808; background-color: #ffffff"> 类把数据“打包”好，然后通过网络发送给客户端。客户端收到后，就可以很方便地打开这个“包裹”，获取里面的内容啦！</span></p><h1 data-lake-id="arab2" id="arab2"><span data-lake-id="uc231ef7d" id="uc231ef7d" style="color: #080808; background-color: #ffffff">三、JSON信息转换配置类</span></h1><p data-lake-id="u2080ec72" id="u2080ec72"><span data-lake-id="u813b96b4" id="u813b96b4" style="color: rgb(6, 6, 7)">在Spring Boot项目中，默认使用Jackson来处理JSON数据，但在有些场景，使用 FastJSON可能更适合，例如：在处理循环引用、复杂对象序列化或追求更高性能时。</span></p><p data-lake-id="u58c1d658" id="u58c1d658"><span data-lake-id="u8cf6c18d" id="u8cf6c18d">通过这个配置类，我们可以：</span></p><ol list="u46ec7eec"><li fid="u3f0bd7c0" data-lake-id="u1c80dde1" id="u1c80dde1"><span data-lake-id="uda44f060" id="uda44f060">替换默认的 JSON 转换器为 FastJSON。</span></li><li fid="u3f0bd7c0" data-lake-id="u7a96ad64" id="u7a96ad64"><span data-lake-id="u1d5fa2ea" id="u1d5fa2ea">自定义 JSON 数据的转换规则，满足项目的需求。</span><span data-lake-id="u86077813" id="u86077813" style="color: rgb(6, 6, 7)">例如：</span></li></ol><ul list="u755a82fa"><li fid="u9d1aa6b0" data-lake-id="ueba48e54" id="ueba48e54"><span data-lake-id="u4fc3c9ed" id="u4fc3c9ed" style="color: rgb(6, 6, 7)">格式化日期。</span></li><li fid="u9d1aa6b0" data-lake-id="u2e530216" id="u2e530216"><span data-lake-id="ud5c245b0" id="ud5c245b0" style="color: rgb(6, 6, 7)">处理</span><code data-lake-id="u7ffb3d01" id="u7ffb3d01"><span data-lake-id="ub02e9f1d" id="ub02e9f1d" style="color: var(--text-primary)">null</span></code><span data-lake-id="u4436f1b3" id="u4436f1b3" style="color: rgb(6, 6, 7)">值。</span></li><li fid="u9d1aa6b0" data-lake-id="ueaa8056a" id="ueaa8056a"><span data-lake-id="u2ce4529b" id="u2ce4529b" style="color: rgb(6, 6, 7)">避免循环引用。</span></li></ul><h2 data-lake-id="wVbEA" id="wVbEA"><span data-lake-id="u51deec0d" id="u51deec0d" style="color: rgb(6, 6, 7)">1. 类的定义</span></h2><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22java%22%2C%22code%22%3A%22%40Configuration%5Cnpublic%20class%20JsonHttpMessageConverterConfig%20%7B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22WHPAK%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D"></card><ul list="ue85aa8bb"><li fid="u8dbee49e" data-lake-id="ud06cb6d0" id="ud06cb6d0"><code data-lake-id="ubb066722" id="ubb066722"><strong><span data-lake-id="ud14a69f9" id="ud14a69f9" class="lake-fontsize-11" style="color: var(--text-primary)">@Configuration</span></strong></code><span data-lake-id="ufb6e4dc9" id="ufb6e4dc9" class="lake-fontsize-11" style="color: rgb(6, 6, 7)">：这是一个Spring注解，表明这个类是一个配置类，Spring会扫描并加载这个类中的配置信息。</span></li></ul><h2 data-lake-id="rSgms" id="rSgms"><span data-lake-id="uc7addce7" id="uc7addce7" style="color: rgb(6, 6, 7)">2. 自定义JSON转换器</span></h2><h3 data-lake-id="VrdhG" id="VrdhG"><span data-lake-id="u8646c96e" id="u8646c96e">2.1 </span><span data-lake-id="u72e528ec" id="u72e528ec" class="lake-fontsize-11" style="color: rgb(6, 6, 7)">定义一个Bean，返回一个</span><code data-lake-id="u07ec7e1d" id="u07ec7e1d"><span data-lake-id="u7aff89c3" id="u7aff89c3" class="lake-fontsize-11" style="color: rgb(6, 6, 7)">HttpMessageConverters</span></code><span data-lake-id="ufc8c61c5" id="ufc8c61c5" class="lake-fontsize-11" style="color: rgb(6, 6, 7)">实例</span></h3><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22java%22%2C%22code%22%3A%22%40Bean%5Cn%40Primary%5Cnpublic%20HttpMessageConverters%20fastJsonHttpMessageConverters()%20%7B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22sQif3%22%7D"></card><ul list="uc62c2544"><li fid="u92a646a7" data-lake-id="u4c4bddfb" id="u4c4bddfb"><code data-lake-id="u11de5b18" id="u11de5b18"><span data-lake-id="ud0dd7001" id="ud0dd7001">@Bean</span></code><span data-lake-id="u6c71166b" id="u6c71166b">：这个注解告诉Spring框架，</span><code data-lake-id="u24a7aea1" id="u24a7aea1"><span data-lake-id="u74f3d54a" id="u74f3d54a">fastJsonHttpMessageConverters</span></code><span data-lake-id="u0f86bf07" id="u0f86bf07">方法的返回值应该被注册为一个Bean。这意味着Spring会调用这个方法，并将返回的</span><code data-lake-id="ud6b53801" id="ud6b53801"><span data-lake-id="ubfc24aa1" id="ubfc24aa1">HttpMessageConverters</span></code><span data-lake-id="u6f05f92e" id="u6f05f92e">实例存储在Spring的上下文中，以便在需要时使用。</span></li><li fid="u92a646a7" data-lake-id="u5ad42e11" id="u5ad42e11"><code data-lake-id="u3a2bf04f" id="u3a2bf04f"><span data-lake-id="uc5ab4f1b" id="uc5ab4f1b">@Primary</span></code><span data-lake-id="u81dae2a1" id="u81dae2a1">：当Spring上下文中存在多个同类型的Bean时，</span><code data-lake-id="u6e3eec28" id="u6e3eec28"><span data-lake-id="ue4c2ac4b" id="ue4c2ac4b">@Primary</span></code><span data-lake-id="ue19e19cd" id="ue19e19cd">注解会指示Spring优先使用这个Bean。这在配置多个</span><code data-lake-id="ue01fc02e" id="ue01fc02e"><span data-lake-id="ufb0ae929" id="ufb0ae929">HttpMessageConverters</span></code><span data-lake-id="u3a5bb2f7" id="u3a5bb2f7">时特别有用，确保Spring MVC使用的是这个自定义的转换器。</span></li></ul><h3 data-lake-id="ZbSr4" id="ZbSr4"><span data-lake-id="ua2439179" id="ua2439179">2.2. </span><strong><span data-lake-id="u47c6f831" id="u47c6f831">创建</span></strong><code data-lake-id="ue3da7499" id="ue3da7499"><span data-lake-id="u14dfe883" id="u14dfe883">FastJsonHttpMessageConverter</span></code><strong><span data-lake-id="u61ea85e5" id="u61ea85e5">实例</span></strong></h3><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22java%22%2C%22code%22%3A%22FastJsonHttpMessageConverter%20fastConverter%20%3D%20new%20FastJsonHttpMessageConverter()%3B%22%2C%22autoWrap%22%3Atrue%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22KDID1%22%7D"></card><ul list="ua553b7ab"><li fid="uc8aff82f" data-lake-id="u120c93d5" id="u120c93d5"><span data-lake-id="u8a036084" id="u8a036084">这里创建了一个</span><code data-lake-id="ue8062f4b" id="ue8062f4b"><span data-lake-id="uada43fe4" id="uada43fe4">FastJsonHttpMessageConverter</span></code><span data-lake-id="u15d73a85" id="u15d73a85">的实例。</span><code data-lake-id="ufb28e44f" id="ufb28e44f"><span data-lake-id="u67ae7493" id="u67ae7493">FastJsonHttpMessageConverter</span></code><span data-lake-id="uae0d0aa6" id="uae0d0aa6">是FastJson提供的一个</span><code data-lake-id="u5ae791f5" id="u5ae791f5"><span data-lake-id="uba3ded2b" id="uba3ded2b">HttpMessageConverter</span></code><span data-lake-id="u35a04c3b" id="u35a04c3b">实现，用于处理JSON数据的序列化和反序列化。</span></li></ul><h3 data-lake-id="UQJ4J" id="UQJ4J"><span data-lake-id="uf4f1a93c" id="uf4f1a93c">2.3. </span><strong><span data-lake-id="u84068777" id="u84068777">配置</span></strong><code data-lake-id="uf3adcfba" id="uf3adcfba"><span data-lake-id="u783720a7" id="u783720a7">FastJsonConfig</span></code></h3><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22java%22%2C%22code%22%3A%22FastJsonConfig%20fastJsonConfig%20%3D%20new%20FastJsonConfig()%3B%5CnfastJsonConfig.setDateFormat(%5C%22yyyy-MM-dd%20HH%3Amm%3Ass%5C%22)%3B%5CnfastJsonConfig.setSerializerFeatures(%5Cn%20%20%20%20%20%20%20%20SerializerFeature.PrettyFormat%2C%5Cn%20%20%20%20%20%20%20%20SerializerFeature.WriteNullStringAsEmpty%2C%5Cn%20%20%20%20%20%20%20%20SerializerFeature.WriteNullListAsEmpty%2C%5Cn%20%20%20%20%20%20%20%20SerializerFeature.WriteMapNullValue%2C%5Cn%20%20%20%20%20%20%20%20SerializerFeature.MapSortField%2C%5Cn%20%20%20%20%20%20%20%20SerializerFeature.DisableCircularReferenceDetect%5Cn)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22HiGN8%22%7D"></card><ul list="uc14e4fe4"><li fid="u9d7a6680" data-lake-id="ubf1042f8" id="ubf1042f8"><code data-lake-id="u315adc08" id="u315adc08"><span data-lake-id="ub7b74ff6" id="ub7b74ff6">FastJsonConfig</span></code><span data-lake-id="ub02b8392" id="ub02b8392">：这是FastJson的配置类，用于设置序列化和反序列化的相关参数。</span></li></ul><ul list="uc14e4fe4" data-lake-indent="1"><li fid="ueefad6e0" data-lake-id="u70fd40fa" id="u70fd40fa"><code data-lake-id="u70aa1594" id="u70aa1594"><span data-lake-id="u65bee820" id="u65bee820">setDateFormat</span></code><span data-lake-id="u831933da" id="u831933da">：设置日期格式为</span><code data-lake-id="uce968c65" id="uce968c65"><span data-lake-id="udc0bef70" id="udc0bef70">yyyy-MM-dd HH:mm:ss</span></code><span data-lake-id="u61898836" id="u61898836">。这意味着所有日期类型的字段在序列化为JSON时，都会使用这个格式。</span></li><li fid="ueefad6e0" data-lake-id="u8f242112" id="u8f242112"><code data-lake-id="ub9b2f537" id="ub9b2f537"><span data-lake-id="u8bc69f88" id="u8bc69f88">setSerializerFeatures</span></code><span data-lake-id="uecd9b63d" id="uecd9b63d">：设置序列化特性，具体包括：</span></li></ul><ul list="uc14e4fe4" data-lake-indent="2"><li fid="u90f3b341" data-lake-id="u8daf45de" id="u8daf45de"><code data-lake-id="ub878f100" id="ub878f100"><span data-lake-id="u4cf950ff" id="u4cf950ff">PrettyFormat</span></code><span data-lake-id="u9db591f6" id="u9db591f6">：输出格式化后的JSON字符串，使JSON更易于阅读。</span></li><li fid="u90f3b341" data-lake-id="u0197b6f4" id="u0197b6f4"><code data-lake-id="u4bb15cde" id="u4bb15cde"><span data-lake-id="u912c66a8" id="u912c66a8">WriteNullStringAsEmpty</span></code><span data-lake-id="uac4e1b80" id="uac4e1b80">：将</span><code data-lake-id="u17e5e968" id="u17e5e968"><span data-lake-id="u1f6fd2c8" id="u1f6fd2c8">null</span></code><span data-lake-id="u9cc33530" id="u9cc33530">的字符串字段序列化为空字符串</span><code data-lake-id="u369e64c3" id="u369e64c3"><span data-lake-id="ud263f261" id="ud263f261">&quot;&quot;</span></code><span data-lake-id="ud66b3ef3" id="ud66b3ef3">，而不是</span><code data-lake-id="u316a7950" id="u316a7950"><span data-lake-id="u56f093f6" id="u56f093f6">null</span></code><span data-lake-id="ub71f7209" id="ub71f7209">。</span></li><li fid="u90f3b341" data-lake-id="u6992528e" id="u6992528e"><code data-lake-id="u703196dc" id="u703196dc"><span data-lake-id="u81bfc7c9" id="u81bfc7c9">WriteNullListAsEmpty</span></code><span data-lake-id="ud27a7ffa" id="ud27a7ffa">：将</span><code data-lake-id="u3701cb06" id="u3701cb06"><span data-lake-id="u54be28e9" id="u54be28e9">null</span></code><span data-lake-id="uf1dc829b" id="uf1dc829b">的列表字段序列化为空列表</span><code data-lake-id="u5c4ff462" id="u5c4ff462"><span data-lake-id="uc9f84c45" id="uc9f84c45">[]</span></code><span data-lake-id="ub1b9169a" id="ub1b9169a">，而不是</span><code data-lake-id="ufaea7df9" id="ufaea7df9"><span data-lake-id="u947e192a" id="u947e192a">null</span></code><span data-lake-id="ubb320fd2" id="ubb320fd2">。</span></li><li fid="u90f3b341" data-lake-id="u8b733296" id="u8b733296"><code data-lake-id="u9a56c036" id="u9a56c036"><span data-lake-id="u087e8ee2" id="u087e8ee2">WriteMapNullValue</span></code><span data-lake-id="u26047248" id="u26047248">：序列化Map时，保留值为</span><code data-lake-id="u409cbc55" id="u409cbc55"><span data-lake-id="u47d511b9" id="u47d511b9">null</span></code><span data-lake-id="u2659011a" id="u2659011a">的字段。</span></li><li fid="u90f3b341" data-lake-id="ua9975ea5" id="ua9975ea5"><code data-lake-id="ub5d1e19a" id="ub5d1e19a"><span data-lake-id="ubb76c411" id="ubb76c411">MapSortField</span></code><span data-lake-id="ub8ab9450" id="ub8ab9450">：对Map的字段进行排序。</span></li><li fid="u90f3b341" data-lake-id="uf8ffdd28" id="uf8ffdd28"><code data-lake-id="ud5a0abbd" id="ud5a0abbd"><span data-lake-id="u7b0263d6" id="u7b0263d6">DisableCircularReferenceDetect</span></code><span data-lake-id="u02a0bf8f" id="u02a0bf8f">：禁用循环引用检测。</span></li></ul><h3 data-lake-id="B4t5b" id="B4t5b"><span data-lake-id="ud6bcf445" id="ud6bcf445">2.4. </span><strong><span data-lake-id="u184c10f4" id="u184c10f4">将配置应用到</span></strong><code data-lake-id="u9fc4d1de" id="u9fc4d1de"><span data-lake-id="uc349b10e" id="uc349b10e">FastJsonHttpMessageConverter</span></code></h3><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22java%22%2C%22code%22%3A%22fastConverter.setFastJsonConfig(fastJsonConfig)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22IXfnr%22%7D"></card><ul list="u195f4bfc"><li fid="ue5dcd741" data-lake-id="u28f812a9" id="u28f812a9"><span data-lake-id="uba643458" id="uba643458">这一步将前面配置好的</span><code data-lake-id="u037a63aa" id="u037a63aa"><span data-lake-id="u60a9371c" id="u60a9371c">FastJsonConfig</span></code><span data-lake-id="u4b706b7b" id="u4b706b7b">应用到</span><code data-lake-id="u3fe7ea17" id="u3fe7ea17"><span data-lake-id="uea830009" id="uea830009">FastJsonHttpMessageConverter</span></code><span data-lake-id="u4bf502db" id="u4bf502db">实例中，使得这个转换器在处理JSON数据时会使用这些配置。</span></li></ul><h3 data-lake-id="NO78V" id="NO78V"><span data-lake-id="u779b2a29" id="u779b2a29">2.5. </span><strong><span data-lake-id="ue7d2527b" id="ue7d2527b">设置支持的媒体类型</span></strong></h3><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22java%22%2C%22code%22%3A%22fastConverter.setSupportedMediaTypes(Collections.singletonList(MediaType.APPLICATION_JSON))%3B%22%2C%22autoWrap%22%3Atrue%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22wMve2%22%7D"></card><ul list="u4a688fcc"><li fid="ua1ec9297" data-lake-id="u718619b1" id="u718619b1"><span data-lake-id="u78b573f5" id="u78b573f5">这里设置</span><code data-lake-id="u79d4b445" id="u79d4b445"><span data-lake-id="u41e25be3" id="u41e25be3">FastJsonHttpMessageConverter</span></code><span data-lake-id="ue078f33a" id="ue078f33a">支持的媒体类型为</span><code data-lake-id="ubcc0b4b0" id="ubcc0b4b0"><span data-lake-id="u808a5a1c" id="u808a5a1c">MediaType.APPLICATION_JSON</span></code><span data-lake-id="u98911bcb" id="u98911bcb">。这意味着这个转换器只处理JSON格式的数据。这是必要的，因为Spring MVC支持多种媒体类型（如XML、JSON等），通过设置支持的媒体类型，可以确保这个转换器只处理JSON数据。</span></li></ul><h3 data-lake-id="efRop" id="efRop"><span data-lake-id="u506b67bb" id="u506b67bb">2.6. </span><strong><span data-lake-id="ubf27ba82" id="ubf27ba82">返回</span></strong><code data-lake-id="ub85fc77c" id="ub85fc77c"><span data-lake-id="u68bafd75" id="u68bafd75">HttpMessageConverters</span></code><strong><span data-lake-id="uf92193b7" id="uf92193b7">实例</span></strong></h3><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22java%22%2C%22code%22%3A%22return%20new%20HttpMessageConverters(fastConverter)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22uE1PI%22%7D"></card><ul list="u04cbfd14"><li fid="uce814bfb" data-lake-id="ub3dd0e93" id="ub3dd0e93"><span data-lake-id="u2f424a46" id="u2f424a46">最后，创建并返回一个</span><code data-lake-id="u72a61183" id="u72a61183"><span data-lake-id="ucfd7a72d" id="ucfd7a72d">HttpMessageConverters</span></code><span data-lake-id="u540af2f0" id="u540af2f0">实例，将配置好的</span><code data-lake-id="u4bc8e140" id="u4bc8e140"><span data-lake-id="u4444dae4" id="u4444dae4">FastJsonHttpMessageConverter</span></code><span data-lake-id="u05f44413" id="u05f44413">添加到其中。Spring会使用这个</span><code data-lake-id="u2dbfb706" id="u2dbfb706"><span data-lake-id="u35c3f931" id="u35c3f931">HttpMessageConverters</span></code><span data-lake-id="u099219f3" id="u099219f3">实例来处理HTTP请求和响应中的JSON数据。</span></li></ul><h2 data-lake-id="HdNy6" id="HdNy6"><span data-lake-id="ub4d37727" id="ub4d37727">总结</span></h2><p data-lake-id="u2be50c5d" id="u2be50c5d"><span data-lake-id="uc0784e27" id="uc0784e27">简单来说，这个类就像是一个“</span><strong><span data-lake-id="u239903a9" id="u239903a9">翻译规则制定者</span></strong><span data-lake-id="u10633dc5" id="u10633dc5">”，告诉 Spring Boot 如何把 Java 对象翻译成 JSON 数据，或者把 JSON 数据翻译成 Java 对象。</span></p><h2 data-lake-id="MpUUY" id="MpUUY"><span data-lake-id="ua181bdf6" id="ua181bdf6">测试</span></h2><ol list="u9f01f627"><li fid="u8ac8b138" data-lake-id="u392a5c93" id="u392a5c93"><span data-lake-id="u6ab19072" id="u6ab19072" style="color: rgb(6, 6, 7)">启动Spring Boot应用。</span></li><li fid="u8ac8b138" data-lake-id="ua0dc5ec9" id="ua0dc5ec9"><span data-lake-id="uc876b73c" id="uc876b73c" style="color: rgb(6, 6, 7)">使用浏览器或Postman访问一个返回JSON的接口，例如 </span><code data-lake-id="uce73532c" id="uce73532c"><span data-lake-id="uda6962b3" id="uda6962b3" style="color: var(--text-primary)">/api/users</span></code><span data-lake-id="uee3ea3b4" id="uee3ea3b4" style="color: rgb(6, 6, 7)">。</span></li><li fid="u8ac8b138" data-lake-id="uc2f26b50" id="uc2f26b50"><span data-lake-id="ue19bc01a" id="ue19bc01a" style="color: rgb(6, 6, 7)">检查响应内容是否符合配置：</span></li></ol><ul list="uff001874" data-lake-indent="1"><li fid="ud1b29f31" data-lake-id="ua05232ce" id="ua05232ce"><span data-lake-id="u95cebe07" id="u95cebe07" style="color: rgb(6, 6, 7)">日期格式是否为 </span><code data-lake-id="u38d4254b" id="u38d4254b"><span data-lake-id="u4d2b9b1f" id="u4d2b9b1f" style="color: var(--text-primary)">yyyy-MM-dd HH:mm:ss</span></code><span data-lake-id="u765ec49d" id="u765ec49d" style="color: rgb(6, 6, 7)">。</span></li><li fid="ud1b29f31" data-lake-id="u29d0ca15" id="u29d0ca15"><span data-lake-id="u6648e365" id="u6648e365" style="color: rgb(6, 6, 7)">是否有格式化（</span><code data-lake-id="uc2c61f34" id="uc2c61f34"><span data-lake-id="u582a3b85" id="u582a3b85" style="color: var(--text-primary)">PrettyFormat</span></code><span data-lake-id="u03ccebed" id="u03ccebed" style="color: rgb(6, 6, 7)">）。</span></li><li fid="ud1b29f31" data-lake-id="u69b99449" id="u69b99449"><span data-lake-id="ufe40ade8" id="ufe40ade8" style="color: rgb(6, 6, 7)">是否将 </span><code data-lake-id="u8c1f5b48" id="u8c1f5b48"><span data-lake-id="u349f7b40" id="u349f7b40" style="color: var(--text-primary)">null</span></code><span data-lake-id="u540236cf" id="u540236cf" style="color: rgb(6, 6, 7)"> 值替换为空字符串或空列表。</span></li><li fid="ud1b29f31" data-lake-id="u0bec8ba9" id="u0bec8ba9"><span data-lake-id="u6ee19945" id="u6ee19945" style="color: rgb(6, 6, 7)">是否禁用了循环引用检测。</span></li></ul><p data-lake-id="u0a9541fd" id="u0a9541fd"><span data-lake-id="u64156d58" id="u64156d58">接口地址：</span><a href="http://localhost:8888/users/1" target="_blank" data-lake-id="ube6549e8" id="ube6549e8"><span data-lake-id="u867dd117" id="u867dd117">http://localhost:8888/users/1</span></a><span data-lake-id="u7c228e33" id="u7c228e33">4</span></p><p data-lake-id="u18a02c12" id="u18a02c12"><card type="inline" name="image" value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2025%2Fpng%2F32516888%2F1743337261859-2e20de5d-2876-4087-865e-ec9d5608aec4.png%22%2C%22taskId%22%3A%22ud1da442e-9f9c-4213-ac7e-75f18c80307%22%2C%22clientId%22%3A%22u56dc0bae-c2e6-4%22%2C%22originalType%22%3A%22binary%22%2C%22width%22%3A687.5%2C%22height%22%3A300%2C%22linkTarget%22%3A%22_blank%22%2C%22name%22%3A%22image.png%22%2C%22size%22%3A139854%2C%22from%22%3A%22paste%22%2C%22originWidth%22%3A1375%2C%22originHeight%22%3A599%2C%22ratio%22%3A2%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22ocrLocations%22%3A%5B%7B%22text%22%3A%22YAMAZAKI9YDCA8T1DRXBX879HISK%22%2C%22x%22%3A391%2C%22y%22%3A500%2C%22width%22%3A446%2C%22height%22%3A23%7D%2C%7B%22text%22%3A%2222024-12-0222%3A35%3A45%22%2C%22x%22%3A934%2C%22y%22%3A216%2C%22width%22%3A287%2C%22height%22%3A29%7D%2C%7B%22text%22%3A%22%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E7%94%9F%E6%88%90%E5%88%9B%E5%BB%BA%E5%9B%BE%E8%A1%A8%22%2C%22x%22%3A740%2C%22y%22%3A59%2C%22width%22%3A360%2C%22height%22%3A29%7D%2C%7B%22text%22%3A%222017-04-0210%3A31%3A20%22%2C%22x%22%3A969%2C%22y%22%3A458%2C%22width%22%3A250%2C%22height%22%3A25%7D%2C%7B%22text%22%3A%222008-10-1315%3A32%3A55%22%2C%22x%22%3A979%2C%22y%22%3A138%2C%22width%22%3A238%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%222013-04-2106%3A43%3A25%22%2C%22x%22%3A963%2C%22y%22%3A497%2C%22width%22%3A266%2C%22height%22%3A27%7D%2C%7B%22text%22%3A%22SER1%40MYDBDEV(LOCALHOST-%E8%A1%A8%22%2C%22x%22%3A667%2C%22y%22%3A4%2C%22width%22%3A385%2C%22height%22%3A24%7D%2C%7B%22text%22%3A%222007-09-2009%3A58%3A26%22%2C%22x%22%3A973%2C%22y%22%3A258%2C%22width%22%3A248%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%222002-10-0115%3A19%3A47%22%2C%22x%22%3A967%2C%22y%22%3A379%2C%22width%22%3A246%2C%22height%22%3A24%7D%2C%7B%22text%22%3A%222016-04-0307%3A42%3A55%22%2C%22x%22%3A959%2C%22y%22%3A338%2C%22width%22%3A262%2C%22height%22%3A25%7D%2C%7B%22text%22%3A%22MARN64%40HKIA6P97I1%22%2C%22x%22%3A398%2C%22y%22%3A381%2C%22width%22%3A268%2C%22height%22%3A22%7D%2C%7B%22text%22%3A%229(121)4616666%22%2C%22x%22%3A126%2C%22y%22%3A337%2C%22width%22%3A217%2C%22height%22%3A27%7D%2C%7B%22text%22%3A%2212(121)3081116%22%2C%22x%22%3A119%2C%22y%22%3A456%2C%22width%22%3A231%2C%22height%22%3A29%7D%2C%7B%22text%22%3A%22WUZIYI%40HZPQBSLHVR%22%2C%22x%22%3A399%2C%22y%22%3A261%2C%22width%22%3A269%2C%22height%22%3A23%7D%2C%7B%22text%22%3A%22134-9591-4348%22%2C%22x%22%3A161%2C%22y%22%3A259%2C%22width%22%3A187%2C%22height%22%3A24%7D%2C%7B%22text%22%3A%22%E4%B8%89%E6%8E%92%E5%BA%8F%E5%88%97%22%2C%22x%22%3A395%2C%22y%22%3A57%2C%22width%22%3A176%2C%22height%22%3A34%7D%2C%7B%22text%22%3A%22198-4397-7663%22%2C%22x%22%3A160%2C%22y%22%3A139%2C%22width%22%3A183%2C%22height%22%3A24%7D%2C%7B%22text%22%3A%22TGRAN%40ICLCD702CAS30A%22%2C%22x%22%3A399%2C%22y%22%3A222%2C%22width%22%3A276%2C%22height%22%3A24%7D%2C%7B%22text%22%3A%22XU91%40MAITG4CL10NAD%22%2C%22x%22%3A402%2C%22y%22%3A422%2C%22width%22%3A273%2C%22height%22%3A22%7D%2C%7B%22text%22%3A%22105954583837%22%2C%22x%22%3A118%2C%22y%22%3A378%2C%22width%22%3A206%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%226%E5%AF%BC%E5%85%A5-%E5%AF%BC%E5%87%BA%22%2C%22x%22%3A613%2C%22y%22%3A58%2C%22width%22%3A210%2C%22height%22%3A31%7D%2C%7B%22text%22%3A%22137784274525%22%2C%22x%22%3A113%2C%22y%22%3A498%2C%22width%22%3A221%2C%22height%22%3A24%7D%2C%7B%22text%22%3A%22202503-3000%3A00%3A00%22%2C%22x%22%3A974%2C%22y%22%3A537%2C%22width%22%3A250%2C%22height%22%3A27%7D%2C%7B%22text%22%3A%22%E4%B8%89%E6%96%87%E6%9C%AC%E7%AD%9B%E9%80%89%22%2C%22x%22%3A180%2C%22y%22%3A60%2C%22width%22%3A219%2C%22height%22%3A30%7D%2C%7B%22text%22%3A%222013-09-3005%3A58%3A49%22%2C%22x%22%3A970%2C%22y%22%3A179%2C%22width%22%3A248%2C%22height%22%3A25%7D%2C%7B%22text%22%3A%225(1223)949061%22%2C%22x%22%3A131%2C%22y%22%3A180%2C%22width%22%3A205%2C%22height%22%3A25%7D%2C%7B%22text%22%3A%22EODJQLGPJC%22%2C%22x%22%3A522%2C%22y%22%3A181%2C%22width%22%3A165%2C%22height%22%3A25%7D%2C%7B%22text%22%3A%22ULHWSA48FD%22%2C%22x%22%3A522%2C%22y%22%3A302%2C%22width%22%3A165%2C%22height%22%3A24%7D%2C%7B%22text%22%3A%22MARGARET9U%22%2C%22x%22%3A404%2C%22y%22%3A304%2C%22width%22%3A150%2C%22height%22%3A21%7D%2C%7B%22text%22%3A%222013-08-0910%3A08%3A05%22%2C%22x%22%3A974%2C%22y%22%3A419%2C%22width%22%3A241%2C%22height%22%3A23%7D%2C%7B%22text%22%3A%22ABJ1SLCHR%22%2C%22x%22%3A696%2C%22y%22%3A260%2C%22width%22%3A134%2C%22height%22%3A24%7D%2C%7B%22text%22%3A%22SKAMING9EXSPSJGELUJ%22%2C%22x%22%3A402%2C%22y%22%3A342%2C%22width%22%3A266%2C%22height%22%3A22%7D%2C%7B%22text%22%3A%22UYUNINGXDSA1NRLQI%22%2C%22x%22%3A407%2C%22y%22%3A462%2C%22width%22%3A274%2C%22height%22%3A21%7D%2C%7B%22text%22%3A%22CREATETIME%22%2C%22x%22%3A971%2C%22y%22%3A105%2C%22width%22%3A151%2C%22height%22%3A24%7D%2C%7B%22text%22%3A%22LMGWCPF%22%2C%22x%22%3A701%2C%22y%22%3A379%2C%22width%22%3A126%2C%22height%22%3A25%7D%2C%7B%22text%22%3A%2211155-7948-738%22%2C%22x%22%3A117%2C%22y%22%3A417%2C%22width%22%3A220%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%22SPLXUJMU%22%2C%22x%22%3A697%2C%22y%22%3A301%2C%22width%22%3A133%2C%22height%22%3A25%7D%2C%7B%22text%22%3A%222023-05-2211%3A10%3A20%22%2C%22x%22%3A957%2C%22y%22%3A299%2C%22width%22%3A262%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%226838-097-8295%22%2C%22x%22%3A129%2C%22y%22%3A218%2C%22width%22%3A201%2C%22height%22%3A25%7D%2C%7B%22text%22%3A%22KWOKKCQCE%22%2C%22x%22%3A401%2C%22y%22%3A182%2C%22width%22%3A163%2C%22height%22%3A22%7D%2C%7B%22text%22%3A%22DTIWKUJF%22%2C%22x%22%3A692%2C%22y%22%3A138%2C%22width%22%3A137%2C%22height%22%3A27%7D%2C%7B%22text%22%3A%22UE7KBKGR%22%2C%22x%22%3A701%2C%22y%22%3A180%2C%22width%22%3A127%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%2210-7033-7564%22%2C%22x%22%3A148%2C%22y%22%3A299%2C%22width%22%3A183%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%222001-02%22%2C%22x%22%3A1263%2C%22y%22%3A258%2C%22width%22%3A96%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%22USEROMYDB%22%2C%22x%22%3A181%2C%22y%22%3A7%2C%22width%22%3A145%2C%22height%22%3A20%7D%2C%7B%22text%22%3A%22JHD19KZMX%22%2C%22x%22%3A542%2C%22y%22%3A141%2C%22width%22%3A150%2C%22height%22%3A24%7D%2C%7B%22text%22%3A%221TA1BG1C%22%2C%22x%22%3A697%2C%22y%22%3A419%2C%22width%22%3A130%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%222008-11%22%2C%22x%22%3A1262%2C%22y%22%3A498%2C%22width%22%3A92%2C%22height%22%3A25%7D%2C%7B%22text%22%3A%222007-0%22%2C%22x%22%3A1264%2C%22y%22%3A378%2C%22width%22%3A92%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%22(NUID(NUI)(NUL)%22%2C%22x%22%3A368%2C%22y%22%3A536%2C%22width%22%3A550%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%222021-05%22%2C%22x%22%3A1262%2C%22y%22%3A298%2C%22width%22%3A95%2C%22height%22%3A28%7D%2C%7B%22text%22%3A%222025-0%22%2C%22x%22%3A1263%2C%22y%22%3A139%2C%22width%22%3A91%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%22ZGYWR8NY%22%2C%22x%22%3A693%2C%22y%22%3A341%2C%22width%22%3A134%2C%22height%22%3A23%7D%2C%7B%22text%22%3A%22%E5%BC%80%E5%A7%8B%E4%BA%8B%E5%8A%A1%22%2C%22x%22%3A25%2C%22y%22%3A60%2C%22width%22%3A125%2C%22height%22%3A30%7D%2C%7B%22text%22%3A%221DJY5KILCF%22%2C%22x%22%3A695%2C%22y%22%3A219%2C%22width%22%3A137%2C%22height%22%3A28%7D%2C%7B%22text%22%3A%22PASSWORD%22%2C%22x%22%3A538%2C%22y%22%3A108%2C%22width%22%3A134%2C%22height%22%3A22%7D%2C%7B%22text%22%3A%222012-02%22%2C%22x%22%3A1260%2C%22y%22%3A178%2C%22width%22%3A95%2C%22height%22%3A27%7D%2C%7B%22text%22%3A%22CATGIBON%22%2C%22x%22%3A697%2C%22y%22%3A460%2C%22width%22%3A132%2C%22height%22%3A23%7D%2C%7B%22text%22%3A%22CALHOST)-%22%2C%22x%22%3A413%2C%22y%22%3A4%2C%22width%22%3A127%2C%22height%22%3A25%7D%2C%7B%22text%22%3A%222014-12%22%2C%22x%22%3A1261%2C%22y%22%3A457%2C%22width%22%3A97%2C%22height%22%3A27%7D%2C%7B%22text%22%3A%22UPDATE%22%2C%22x%22%3A1263%2C%22y%22%3A106%2C%22width%22%3A87%2C%22height%22%3A23%7D%2C%7B%22text%22%3A%222002-0%22%2C%22x%22%3A1261%2C%22y%22%3A218%2C%22width%22%3A97%2C%22height%22%3A27%7D%2C%7B%22text%22%3A%222012-0%24%22%2C%22x%22%3A1262%2C%22y%22%3A339%2C%22width%22%3A97%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%222025-0%22%2C%22x%22%3A1259%2C%22y%22%3A537%2C%22width%22%3A97%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%222012-05%22%2C%22x%22%3A1263%2C%22y%22%3A418%2C%22width%22%3A92%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%22PHONE%22%2C%22x%22%3A160%2C%22y%22%3A107%2C%22width%22%3A115%2C%22height%22%3A22%7D%2C%7B%22text%22%3A%22STATUS%22%2C%22x%22%3A832%2C%22y%22%3A108%2C%22width%22%3A90%2C%22height%22%3A21%7D%2C%7B%22text%22%3A%22MALL%22%2C%22x%22%3A405%2C%22y%22%3A109%2C%22width%22%3A66%2C%22height%22%3A19%7D%2C%7B%22text%22%3A%2214NU)%22%2C%22x%22%3A120%2C%22y%22%3A546%2C%22width%22%3A133%2C%22height%22%3A10%7D%2C%7B%22text%22%3A%221092%22%2C%22x%22%3A910%2C%22y%22%3A497%2C%22width%22%3A86%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%22118%22%2C%22x%22%3A916%2C%22y%22%3A457%2C%22width%22%3A66%2C%22height%22%3A28%7D%2C%7B%22text%22%3A%22SALT%22%2C%22x%22%3A655%2C%22y%22%3A104%2C%22width%22%3A107%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%22125%22%2C%22x%22%3A914%2C%22y%22%3A335%2C%22width%22%3A62%2C%22height%22%3A30%7D%2C%7B%22text%22%3A%22DBDEVLOCA%22%2C%22x%22%3A295%2C%22y%22%3A8%2C%22width%22%3A150%2C%22height%22%3A18%7D%2C%7B%22text%22%3A%221022%22%2C%22x%22%3A914%2C%22y%22%3A216%2C%22width%22%3A84%2C%22height%22%3A30%7D%2C%7B%22text%22%3A%2289%22%2C%22x%22%3A925%2C%22y%22%3A376%2C%22width%22%3A47%2C%22height%22%3A29%7D%2C%7B%22text%22%3A%22103%22%2C%22x%22%3A916%2C%22y%22%3A178%2C%22width%22%3A58%2C%22height%22%3A25%7D%2C%7B%22text%22%3A%2253%22%2C%22x%22%3A924%2C%22y%22%3A138%2C%22width%22%3A64%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%2276%22%2C%22x%22%3A921%2C%22y%22%3A297%2C%22width%22%3A64%2C%22height%22%3A26%7D%2C%7B%22text%22%3A%22%E5%AF%B9%E5%AE%B6%22%2C%22x%22%3A43%2C%22y%22%3A4%2C%22width%22%3A44%2C%22height%22%3A25%7D%5D%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23ece5e3%22%2C%22id%22%3A%22u3d1cb862%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D"></card></p><p data-lake-id="u79920036" id="u79920036"><strong><span data-lake-id="uf6c4dfa6" id="uf6c4dfa6">经过自定义 JSON 转换器之后，返回的格式如下：</span></strong></p><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%22%7B%5Cn%20%20%20%20%5C%22createTime%5C%22%3A%20%5C%222025-03-30%2000%3A00%3A00%5C%22%2C%5Cn%20%20%20%20%5C%22email%5C%22%3A%20%5C%22%5C%22%2C%5Cn%20%20%20%20%5C%22id%5C%22%3A%2014%2C%5Cn%20%20%20%20%5C%22name%5C%22%3A%20%5C%22%5C%22%5Cn%7D%22%2C%22autoWrap%22%3Atrue%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22fontSize%22%3A14%2C%22customStyle%22%3A%5B%5D%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22fs0PR%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D"></card><p data-lake-id="u5e1726f5" id="u5e1726f5"><strong><span data-lake-id="u74827ef6" id="u74827ef6">如果，我们把 JSON 转换器去掉，返回的格式是这个样子的：</span></strong></p><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%22%7B%5Cn%20%20%20%20%5C%22id%5C%22%3A%2014%2C%5Cn%20%20%20%20%5C%22name%5C%22%3A%20null%2C%5Cn%20%20%20%20%5C%22email%5C%22%3A%20null%2C%5Cn%20%20%20%20%5C%22createTime%5C%22%3A%20%5C%222025-03-30T00%3A00%3A00%5C%22%5Cn%7D%22%2C%22autoWrap%22%3Atrue%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22fontSize%22%3A14%2C%22customStyle%22%3A%5B%5D%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22pEPeF%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D"></card><h1 data-lake-id="UcaOC" id="UcaOC"><span data-lake-id="u9da3817b" id="u9da3817b" style="color: #080808; background-color: #ffffff">扩展：测试</span><strong><span data-lake-id="u5f8f3f18" id="u5f8f3f18" style="color: rgb(6, 6, 7)">循环引用检测的作用</span></strong><span data-lake-id="u5f1733b4" id="u5f1733b4" style="color: #080808; background-color: #ffffff">。</span></h1><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22java%22%2C%22code%22%3A%22public%20static%20void%20main(String%5B%5D%20args)%7B%5Cn%20%20%20%20List%3CObject%3E%20list%20%3D%20new%20ArrayList%3C%3E()%3B%5Cn%20%20%20%20Object%20o%20%3D%20new%20Object()%3B%5Cn%20%20%20%20list.add(o)%3B%5Cn%20%20%20%20list.add(o)%3B%5Cn%20%20%20%20System.out.println(list.size())%3B%20%2F%2F%20%E8%BE%93%E5%87%BA%E5%88%97%E8%A1%A8%E7%9A%84%E5%A4%A7%E5%B0%8F%5Cn%20%20%20%20System.out.println(JSONObject.toJSONString(list))%3B%20%2F%2F%20%E5%B0%86%E5%88%97%E8%A1%A8%E8%BD%AC%E6%8D%A2%E4%B8%BA%20JSON%20%E5%AD%97%E7%AC%A6%E4%B8%B2%5Cn%20%20%20%20System.out.println(JSONObject.toJSONString(list%2C%20SerializerFeature.DisableCircularReferenceDetect))%3B%20%2F%2F%20%E7%A6%81%E7%94%A8%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E6%A3%80%E6%B5%8B%5Cn%7D%22%2C%22autoWrap%22%3Atrue%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22m78Mj%22%7D"></card><p data-lake-id="u569c1387" id="u569c1387"><span data-lake-id="ua0eaebcc" id="ua0eaebcc">输出结果：</span></p><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%222%5Cn%5B%7B%7D%2C%7B%5C%22%24ref%5C%22%3A%5C%22%24%5B0%5D%5C%22%7D%5D%5Cn%5B%7B%7D%2C%7B%7D%5D%22%2C%22autoWrap%22%3Atrue%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22fontSize%22%3A14%2C%22customStyle%22%3A%5B%5D%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22r3unh%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D"></card><ul list="u6bfb8b91"><li fid="ucc96253f" data-lake-id="u9aea2568" id="u9aea2568"><strong><span data-lake-id="ue239a381" id="ue239a381" style="color: rgb(6, 6, 7)">默认情况下</span></strong><span data-lake-id="u215b2976" id="u215b2976" style="color: rgb(6, 6, 7)">：</span><code data-lake-id="u4c53178b" id="u4c53178b"><span data-lake-id="ucabbbcfc" id="ucabbbcfc" style="color: var(--text-primary)">fastjson</span></code><span data-lake-id="u6ca59f3b" id="u6ca59f3b" style="color: rgb(6, 6, 7)"> 会检测重复引用，并使用 </span><code data-lake-id="uda42ce0b" id="uda42ce0b"><span data-lake-id="ua0ca930c" id="ua0ca930c" style="color: var(--text-primary)">$ref</span></code><span data-lake-id="u5c7b7aa5" id="u5c7b7aa5" style="color: rgb(6, 6, 7)"> 来优化序列化过程，避免重复序列化同一个对象。</span></li><li fid="ucc96253f" data-lake-id="ua510e408" id="ua510e408"><strong><span data-lake-id="u76cdee77" id="u76cdee77" style="color: rgb(6, 6, 7)">关闭循环引用检测</span></strong><span data-lake-id="u088cc48e" id="u088cc48e" style="color: rgb(6, 6, 7)">：使用 </span><code data-lake-id="ued3f1cda" id="ued3f1cda"><span data-lake-id="uf87b5cd3" id="uf87b5cd3" style="color: var(--text-primary)">SerializerFeature.DisableCircularReferenceDetect</span></code><span data-lake-id="u28e85c3a" id="u28e85c3a" style="color: rgb(6, 6, 7)"> 后，</span><code data-lake-id="ucad1f227" id="ucad1f227"><span data-lake-id="u33e79ec6" id="u33e79ec6" style="color: var(--text-primary)">fastjson</span></code><span data-lake-id="ue9803415" id="ue9803415" style="color: rgb(6, 6, 7)"> 不再使用 </span><code data-lake-id="u5a16f884" id="u5a16f884"><span data-lake-id="u8cb9c156" id="u8cb9c156" style="color: var(--text-primary)">$ref</span></code><span data-lake-id="u08572844" id="u08572844" style="color: rgb(6, 6, 7)">，而是独立序列化每个对象。</span></li></ul><p data-lake-id="uccc0b571" id="uccc0b571"><strong><span data-lake-id="u7aeb759a" id="u7aeb759a" style="color: #DF2A3F">关闭循环引用检测之后，又会带来一个新问题？</span></strong></p><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20org.example.service.config%3B%5Cn%5Cnimport%20com.alibaba.fastjson.JSONObject%3B%5Cnimport%20com.alibaba.fastjson.serializer.SerializerFeature%3B%5Cn%5Cnimport%20java.util.ArrayList%3B%5Cnimport%20java.util.List%3B%5Cn%5Cnpublic%20class%20CircularReferenceExample%20%7B%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F%20%E5%88%9B%E5%BB%BA%E4%B8%A4%E4%B8%AA%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%BD%A2%E6%88%90%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%5Cn%20%20%20%20%20%20%20%20Person%20personA%20%3D%20new%20Person(%5C%22Alice%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20Person%20personB%20%3D%20new%20Person(%5C%22Bob%5C%22)%3B%5Cn%5Cn%20%20%20%20%20%20%20%20%2F%2F%20%E8%AE%A9%20personA%20%E5%BC%95%E7%94%A8%20personB%5Cn%20%20%20%20%20%20%20%20personA.setFriend(personB)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%20%E8%AE%A9%20personB%20%E5%BC%95%E7%94%A8%20personA%5Cn%20%20%20%20%20%20%20%20personB.setFriend(personA)%3B%5Cn%5Cn%20%20%20%20%20%20%20%20%2F%2F%20%E5%B0%86%20personA%20%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%88%97%E8%A1%A8%E4%B8%AD%5Cn%20%20%20%20%20%20%20%20List%3CPerson%3E%20list%20%3D%20new%20ArrayList%3C%3E()%3B%5Cn%20%20%20%20%20%20%20%20list.add(personA)%3B%5Cn%5Cn%20%20%20%20%20%20%20%20%2F%2F%20%E8%BE%93%E5%87%BA%E5%88%97%E8%A1%A8%E7%9A%84%E5%A4%A7%E5%B0%8F%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E5%88%97%E8%A1%A8%E5%A4%A7%E5%B0%8F%3A%20%5C%22%20%2B%20list.size())%3B%20%2F%2F%20%E8%BE%93%E5%87%BA%201%5Cn%5Cn%20%20%20%20%20%20%20%20%2F%2F%20%E5%B0%86%E5%88%97%E8%A1%A8%E8%BD%AC%E6%8D%A2%E4%B8%BA%20JSON%20%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%88%E9%BB%98%E8%AE%A4%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E6%A3%80%E6%B5%8B%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%EF%BC%89%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E9%BB%98%E8%AE%A4%E6%83%85%E5%86%B5%E4%B8%8B%E5%BA%8F%E5%88%97%E5%8C%96%EF%BC%9A%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(JSONObject.toJSONString(list))%3B%5Cn%5Cn%20%20%20%20%20%20%20%20%2F%2F%20%E7%A6%81%E7%94%A8%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E6%A3%80%E6%B5%8B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%A6%81%E7%94%A8%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E6%A3%80%E6%B5%8B%E5%90%8E%E7%9A%84%20JSON%20%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%9A%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(JSONObject.toJSONString(list%2C%20SerializerFeature.DisableCircularReferenceDetect))%3B%5Cn%20%20%20%20%7D%5Cn%7D%5Cn%5Cnclass%20Person%20%7B%5Cn%20%20%20%20private%20String%20name%3B%5Cn%20%20%20%20private%20Person%20friend%3B%5Cn%5Cn%20%20%20%20public%20Person(String%20name)%20%7B%5Cn%20%20%20%20%20%20%20%20this.name%20%3D%20name%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20public%20String%20getName()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20name%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20public%20void%20setName(String%20name)%20%7B%5Cn%20%20%20%20%20%20%20%20this.name%20%3D%20name%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20public%20Person%20getFriend()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20friend%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20public%20void%20setFriend(Person%20friend)%20%7B%5Cn%20%20%20%20%20%20%20%20this.friend%20%3D%20friend%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Atrue%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22fontSize%22%3A14%2C%22customStyle%22%3A%5B%5D%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22vlzER%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D"></card><p data-lake-id="u1a1af333" id="u1a1af333"><card type="inline" name="image" value="data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2025%2Fpng%2F32516888%2F1743432669045-8b6fc734-d617-4e30-87dd-b71f1af48187.png%22%2C%22taskId%22%3A%22u3203e643-edcc-46c9-951c-1688e266956%22%2C%22clientId%22%3A%22ub5be25f3-3a40-4%22%2C%22originalType%22%3A%22binary%22%2C%22width%22%3A914.5%2C%22height%22%3A246%2C%22linkTarget%22%3A%22_blank%22%2C%22name%22%3A%22image.png%22%2C%22size%22%3A127490%2C%22from%22%3A%22paste%22%2C%22originWidth%22%3A1829%2C%22originHeight%22%3A491%2C%22ratio%22%3A2%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22ocrLocations%22%3A%5B%7B%22text%22%3A%22ATCOM%2CALIBABA.FASTJSON%2CSERIALIZER.JAVABEANSENIALIZER.WMITE(JAVABEANSENIALIZEN.JAVA%3A172)%22%2C%22x%22%3A78%2C%22y%22%3A335%2C%22width%22%3A1690%2C%22height%22%3A31%7D%2C%7B%22text%22%3A%22TCOM%2CALIBABA%2CFASTJSON%2CSERIALIZER%2CFIELDSENIALIZER%2CWNITEVALUE(FIELDSERIALIZEN%2CJAVA%3A%E4%BA%8618)%22%2C%22x%22%3A100%2C%22y%22%3A438%2C%22width%22%3A1660%2C%22height%22%3A34%7D%2C%7B%22text%22%3A%22%5C%22FRIEND%5C%22%3A%7B%5C%22FRIEND%5C%22%3A%7B%5C%22%24REF%5C%22%3A%5C%22..%5C%22%7D%2C%5C%22NAME%5C%22%3A%5C%22BOB%5C%22%7D%2C%5C%22NAME%5C%22%3A%5C%22ALICE%5C%22%7D%5D%22%2C%22x%22%3A45%2C%22y%22%3A172%2C%22width%22%3A1206%2C%22height%22%3A34%7D%2C%7B%22text%22%3A%22TCOM%2CALIBABA%2CFASTISON%2CSERIALIZERJAVABEANSERIALIZER%2CWNITE(JAVABEANSENIALIZEN.JAVA%3A154)%22%2C%22x%22%3A103%2C%22y%22%3A386%2C%22width%22%3A1668%2C%22height%22%3A34%7D%2C%7B%22text%22%3A%22%3ALPROGRAMFILESJAVAJDK1.8.0_144BINJAVA.EX%22%2C%22x%22%3A50%2C%22y%22%3A9%2C%22width%22%3A872%2C%22height%22%3A36%7D%2C%7B%22text%22%3A%22EXCEPTIONINTHREAD%5C%22MAIN%5C%22JAVA.LANGSTAC%22%2C%22x%22%3A14%2C%22y%22%3A278%2C%22width%22%3A787%2C%22height%22%3A36%7D%2C%7B%22text%22%3A%22VERFLOWERRONCREATEBREAKPOINT%22%2C%22x%22%3A837%2C%22y%22%3A281%2C%22width%22%3A505%2C%22height%22%3A30%7D%2C%7B%22text%22%3A%22%E9%BB%98%E8%AE%A4%E6%83%85%E5%86%B5%E4%B8%8B%E5%BA%8F%E5%88%97%E5%8C%96%3A%22%2C%22x%22%3A20%2C%22y%22%3A116%2C%22width%22%3A265%2C%22height%22%3A34%7D%2C%7B%22text%22%3A%22%E7%A6%81%E7%94%A8%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8%E6%A3%80%E6%B5%8B%E5%90%8E%E7%9A%84JS0%E5%AD%97%E7%AC%A6%E4%B8%B2%3A%22%2C%22x%22%3A18%2C%22y%22%3A223%2C%22width%22%3A552%2C%22height%22%3A36%7D%2C%7B%22text%22%3A%22(ACODEGEEX%22%2C%22x%22%3A1489%2C%22y%22%3A279%2C%22width%22%3A211%2C%22height%22%3A28%7D%2C%7B%22text%22%3A%22%E5%88%97%E8%A1%A8%E5%A4%A7%E5%B0%8F%3A1%22%2C%22x%22%3A20%2C%22y%22%3A63%2C%22width%22%3A200%2C%22height%22%3A35%7D%5D%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f9f4f3%22%2C%22id%22%3A%22u5d78d6de%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D"></card></p><p data-lake-id="u33f87477" id="u33f87477"><span data-lake-id="u17c9125f" id="u17c9125f" style="color: rgb(6, 6, 7)">​</span><br></p><h3 data-lake-id="eafe2299" id="eafe2299"><span data-lake-id="udd19e6e7" id="udd19e6e7" style="color: rgb(6, 6, 7)">关闭循环引用检测的场景</span></h3><ul list="ub83f8eec"><li fid="u8d575112" data-lake-id="u06cd2205" id="u06cd2205"><strong><span data-lake-id="u51aac0d9" id="u51aac0d9" style="color: rgb(6, 6, 7)">避免重复引用的</span></strong><code data-lake-id="uf7b1afa6" id="uf7b1afa6"><strong><span data-lake-id="ua2cc33fe" id="ua2cc33fe" style="color: rgb(6, 6, 7)">r</span></strong><em><strong><span data-lake-id="u991af15d" id="u991af15d" style="color: rgb(6, 6, 7)">ef</span></strong></em></code><strong><span data-lake-id="u42045462" id="u42045462" style="color: rgb(6, 6, 7)">显示</span></strong><span data-lake-id="uea76b7a3" id="uea76b7a3" style="color: rgb(6, 6, 7)">：在某些情况下，开发者可能不希望在序列化后的</span><em><span data-lake-id="ub3fc19ab" id="ub3fc19ab" style="color: rgb(6, 6, 7)">JSON</span></em><span data-lake-id="u8a479d33" id="u8a479d33" style="color: rgb(6, 6, 7)">数据中出现重复引用的“</span><code data-lake-id="u402a52cc" id="u402a52cc"><span data-lake-id="u79ac81e2" id="u79ac81e2" style="color: rgb(6, 6, 7)">ref</span></code><span data-lake-id="u23d36f33" id="u23d36f33" style="color: rgb(6, 6, 7)">”标识，关闭循环引用检测可以实现这一点。</span></li><li fid="u8d575112" data-lake-id="uc37d2c6f" id="uc37d2c6f"><strong><span data-lake-id="u1a7cd4a1" id="u1a7cd4a1" style="color: rgb(6, 6, 7)">提升性能</span></strong><span data-lake-id="uc0087266" id="uc0087266" style="color: rgb(6, 6, 7)">：关闭循环引用检测能够提升序列化时的性能</span><span data-lake-id="ucf915050" id="ucf915050" style="color: rgb(6, 6, 7)">。</span></li></ul><h3 data-lake-id="a2f21619" id="a2f21619"><span data-lake-id="ud75c73e6" id="ud75c73e6" style="color: rgb(6, 6, 7)">不关闭循环引用检测的场景</span></h3><ul list="u086adcb6"><li fid="u42bd5aa7" data-lake-id="u9be5a9e2" id="u9be5a9e2"><strong><span data-lake-id="ub67fbab7" id="ub67fbab7" style="color: rgb(6, 6, 7)">防止栈溢出异常</span></strong><span data-lake-id="u0d874024" id="u0d874024" style="color: rgb(6, 6, 7)">：如果存在循环引用，关闭循环引用检测可能会导致 </span><code data-lake-id="u956a572c" id="u956a572c"><span data-lake-id="u2cd66305" id="u2cd66305" style="color: var(--text-primary)">StackOverflowError</span></code><span data-lake-id="u497547d2" id="u497547d2" style="color: rgb(6, 6, 7)"> 异常。因为循环引用检测是 FastJSON 提供的一种避免运行时异常的机制，如果关闭它，循环引用时就无法检测到这种异常情况。</span></li><li fid="u42bd5aa7" data-lake-id="u50c3581b" id="u50c3581b"><strong><span data-lake-id="ubecda945" id="ubecda945" style="color: rgb(6, 6, 7)">保持数据的正确性</span></strong><span data-lake-id="uc2942968" id="uc2942968" style="color: rgb(6, 6, 7)">：开启循环引用检测可以正确处理循环引用的情况，确保序列化和反序列化的结果符合预期。</span></li></ul><h3 data-lake-id="19444e70" id="19444e70"><span data-lake-id="ube764770" id="ube764770" style="color: rgb(6, 6, 7)">总结</span></h3><p data-lake-id="u83e16fba" id="u83e16fba"><span data-lake-id="ub90f5d65" id="ub90f5d65" style="color: rgb(6, 6, 7)">在实际项目开发中，</span><strong><span data-lake-id="u5952c636" id="u5952c636" style="color: rgb(6, 6, 7)">保持循环引用检测开启</span></strong><span data-lake-id="u8f04cf03" id="u8f04cf03" style="color: rgb(6, 6, 7)">是更安全和更常见的选择。如果确实需要关闭循环引用检测，应该谨慎评估其风险，并确保代码中不存在循环引用。</span></p><p data-lake-id="ub1d3a409" id="ub1d3a409"><span data-lake-id="u4f1daad5" id="u4f1daad5" style="color: rgb(6, 6, 7)">在 Spring Boot 项目中，可以通过</span><strong><span data-lake-id="uf19b4200" id="uf19b4200" style="color: rgb(6, 6, 7)">局部配置</span></strong><span data-lake-id="uedd93980" id="uedd93980" style="color: rgb(6, 6, 7)">来灵活处理循环引用检测。例如，可以在特定的序列化场景中关闭循环引用检测，而不影响其他部分。</span></p><h3 data-lake-id="fydnK" id="fydnK"><span data-lake-id="u871110a7" id="u871110a7" style="color: rgb(6, 6, 7)">那么如何避免重复引用的</span><code data-lake-id="ue9db5eeb" id="ue9db5eeb"><span data-lake-id="u9edb2cce" id="u9edb2cce" style="color: rgb(6, 6, 7)">ref</span></code><span data-lake-id="ub6fc560c" id="ub6fc560c" style="color: rgb(6, 6, 7)">显示呢？</span><span data-lake-id="u2ae9197d" id="u2ae9197d" style="color: #DF2A3F">避免多处引用同一个对象</span></h3><p data-lake-id="u384bd525" id="u384bd525"><span data-lake-id="ub60d845a" id="ub60d845a">在 Java 编程中，对象是通过引用传递的。如果你在多个地方引用同一个对象，修改一个地方的对象可能会导致其他地方的引用也发生变化，这可能会引发一些难以察觉的错误。特别是在使用 FastJSON 进行序列化时，这种问题可能会更加明显。</span></p><h4 data-lake-id="FYbZM" id="FYbZM"><span data-lake-id="u685d4dcf" id="u685d4dcf">示例</span></h4><p data-lake-id="uedd304a8" id="uedd304a8"><span data-lake-id="u066416e7" id="u066416e7">假设你有以下代码：</span></p><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22java%22%2C%22code%22%3A%22public%20class%20Person%20%7B%5Cn%20%20%20%20private%20String%20name%3B%5Cn%20%20%20%20private%20List%3CString%3E%20hobbies%3B%5Cn%5Cn%20%20%20%20%2F%2F%20%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E3%80%81getter%20%E5%92%8C%20setter%20%E7%9C%81%E7%95%A5%5Cn%7D%5Cn%5Cnpublic%20class%20Main%20%7B%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20%7B%5Cn%20%20%20%20%20%20%20%20List%3CString%3E%20hobbies%20%3D%20new%20ArrayList%3C%3E()%3B%5Cn%20%20%20%20%20%20%20%20hobbies.add(%5C%22Reading%5C%22)%3B%5Cn%5Cn%20%20%20%20%20%20%20%20Person%20person1%20%3D%20new%20Person(%5C%22Alice%5C%22%2C%20hobbies)%3B%5Cn%20%20%20%20%20%20%20%20Person%20person2%20%3D%20new%20Person(%5C%22Bob%5C%22%2C%20hobbies)%3B%5Cn%5Cn%20%20%20%20%20%20%20%20%2F%2F%20%E4%BF%AE%E6%94%B9%20person2%20%E7%9A%84%20hobbies%5Cn%20%20%20%20%20%20%20%20person2.getHobbies().add(%5C%22Swimming%5C%22)%3B%5Cn%5Cn%20%20%20%20%20%20%20%20System.out.println(person1.getHobbies())%3B%20%2F%2F%20%E8%BE%93%E5%87%BA%EF%BC%9A%5BReading%2C%20Swimming%5D%5Cn%20%20%20%20%20%20%20%20System.out.println(person2.getHobbies())%3B%20%2F%2F%20%E8%BE%93%E5%87%BA%EF%BC%9A%5BReading%2C%20Swimming%5D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22A3AoE%22%7D"></card><p data-lake-id="u5d771ca1" id="u5d771ca1"><span data-lake-id="u33a067d0" id="u33a067d0">在这个例子中，</span><code data-lake-id="u41c590a9" id="u41c590a9"><span data-lake-id="u6e748867" id="u6e748867">person1</span></code><span data-lake-id="ubad2d2fe" id="ubad2d2fe"> 和 </span><code data-lake-id="u50996ce4" id="u50996ce4"><span data-lake-id="u27d50df0" id="u27d50df0">person2</span></code><span data-lake-id="uc7d556e1" id="uc7d556e1"> 共享同一个 </span><code data-lake-id="u4c6082a6" id="u4c6082a6"><span data-lake-id="u487836b4" id="u487836b4">hobbies</span></code><span data-lake-id="u81ca15d3" id="u81ca15d3"> 列表。当你修改 </span><code data-lake-id="u618846f5" id="u618846f5"><span data-lake-id="ub88eeb4c" id="ub88eeb4c">person2</span></code><span data-lake-id="u66c63d69" id="u66c63d69"> 的 </span><code data-lake-id="u448ea59e" id="u448ea59e"><span data-lake-id="uba42ad4a" id="uba42ad4a">hobbies</span></code><span data-lake-id="u618b8114" id="u618b8114"> 时，</span><code data-lake-id="u72fcc0e6" id="u72fcc0e6"><span data-lake-id="ub49886cd" id="ub49886cd">person1</span></code><span data-lake-id="u8ea2366d" id="u8ea2366d"> 的 </span><code data-lake-id="uca25d51c" id="uca25d51c"><span data-lake-id="ue6911865" id="ue6911865">hobbies</span></code><span data-lake-id="ub95e0871" id="ub95e0871"> 也会被修改，这可能不是你期望的结果。</span></p><h4 data-lake-id="eu3aI" id="eu3aI"><span data-lake-id="u44abf483" id="u44abf483">改进</span></h4><p data-lake-id="u45300e1c" id="u45300e1c"><span data-lake-id="u6aa094d7" id="u6aa094d7">为了避免这种情况，可以在创建对象时使用新的集合或对象：</span></p><card type="inline" name="codeblock" value="data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22java%22%2C%22code%22%3A%22Person%20person1%20%3D%20new%20Person(%5C%22Alice%5C%22%2C%20new%20ArrayList%3C%3E(hobbies))%3B%5CnPerson%20person2%20%3D%20new%20Person(%5C%22Bob%5C%22%2C%20new%20ArrayList%3C%3E(hobbies))%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Atrue%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22BeEwu%22%7D"></card><p data-lake-id="ua0737e96" id="ua0737e96"><span data-lake-id="ubdb124bf" id="ubdb124bf">这样，每个 </span><code data-lake-id="ua55f4065" id="ua55f4065"><span data-lake-id="u1e3a8cfa" id="u1e3a8cfa">Person</span></code><span data-lake-id="u73918735" id="u73918735"> 对象都有自己的 </span><code data-lake-id="u8c2893c1" id="u8c2893c1"><span data-lake-id="u8ea71fb3" id="u8ea71fb3">hobbies</span></code><span data-lake-id="u24b05cce" id="u24b05cce"> 列表，互不影响。</span></p>